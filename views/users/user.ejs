<!DOCTYPE html>
<html>
  <head>
    <title><%= posts[0].author %> - Verdaemon</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/styles/post-blocks.css">
    <link rel="stylesheet" href="/styles/skeleton.css">
    <link rel="stylesheet" href="/fonts/opensans/css/all.css">
    <link rel="stylesheet" href="/fonts/fontawesome/css/all.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
      $(function(){ $("#included-header").load("/html/templates/header.html"); });
      $(function(){ $("#included-footer").load("/html/templates/footer.html"); });
    </script>
  </head>

  <body>
    <header id="included-header"></header>

    <main>
      <h1 class="intro">Posts By <%= posts[0].author %> </h1>
      <% for (var i=0; i<posts.length; ++i) {%>
        <div class="post-block">
          <div class="post-left">
            <a href="/posts/<%= posts[i].pid %>"><img src="/media/pid/<%= posts[i].pid %>/<%= posts[i].banner %>"></a>
          </div>
          <div class="post-right">
            <h3><a href="/posts/<%= posts[i].pid %>/"><%= posts[i].title %></a></h3>
            <p>By <a href="/users/<%= posts[i].uid %>"><%= posts[i].author %></a></p>
          </div>
          <% if (posts[i].uid === uid) { %>
            <div class="delete-post" id="<%= posts[i].pid %>" onclick="deletePost(this.id)">
              <i class="far fa-trash-alt"></i>
            </div>
          <% } %>
        </div>
      <% } %>
    </main>

    <footer id="included-footer"></footer>

    <% if (posts[0].uid === uid) { %>
      <script>
        async function deletePost(pid) {
          fetch(`/posts/${pid}`, { method: "DELETE" })
          .catch(console.log);
        }
      </script>
    <% } %>
  </body>
</html>
